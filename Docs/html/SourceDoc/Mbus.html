<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">


<title>SourceDoc/Mbus - Freevo 2.0 Wiki</title>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" href="../modern/css/freevo.css">

<link rel="alternate" title="Freevo 2.0 Wiki Recent Changes" href="/cgi-bin/freevo-2.0/RecentChanges?action=rss_rc&amp;ddiffs=1&amp;unique=1" type="application/rss+xml">
<link rel="Start" href="/cgi-bin/freevo-2.0/Index">
<link rel="Alternate" title="Wiki Markup" href="/cgi-bin/freevo-2.0/SourceDoc/Mbus?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/cgi-bin/freevo-2.0/SourceDoc/Mbus?action=print">
<link rel="Up" href="/cgi-bin/freevo-2.0/SourceDoc">
<link rel="Search" href="/cgi-bin/freevo-2.0/FindPage">
<link rel="Index" href="/cgi-bin/freevo-2.0/TitleIndex">
<link rel="Glossary" href="/cgi-bin/freevo-2.0/WordIndex">
<link rel="Help" href="/cgi-bin/freevo-2.0/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">

            <!-- Header Logo and Status Line -->
<div id="titlebar"><span class="name"><a href="http://freevo.sourceforge.net/" target="_blank">Freevo</a></span></div>
<div id="header">
<ul>

	<li><a href="../Index.html">User Documentation</a></li>
	<li id="current"><a href="../SourceDoc.html">Source Documenation</a></li>
        
</ul>
</div>
<p>&nbsp;</p>
<div id="page" lang="en" dir="ltr"><!-- start page -->


<h1 id="title">SourceDoc/Mbus</h1>
<div lang="en" id="content" dir="ltr">
<a id="top"></a>
<ol>

<li>
<a href="#head-6b2c7dc2c37bb4de8f07a2425979f4455abc9c89">mcomm</a>
<ol>

<li>
<a href="#head-da2c960c3e618a0716c401064b2b6b207e26509a">Creating a server</a>
</li>

<li>
<a href="#head-fc8f2a0c3bf9ac26c708aa5efae3bc454dab6876">Client</a>
</li>

</ol>

<li>
<a href="#head-60aaf65c3022011dec7475b38384b80dd246250e">PyMbus</a>
</li>

</ol>
<p> </p>

<h2 id="head-6b2c7dc2c37bb4de8f07a2425979f4455abc9c89">mcomm</h2>

<p>mcomm.py is a small layer between Freevo and PyMbus to make usage of the mbus simpler. Warning: the interface itself may change in the future, but only on some minor details. </p>
<p>Freevo has a wrapper for the important mbus functions for easier access inside helpers and plugins. By using the wrapper, the application will join the mbus with the following naming scheme: "app=freevo, type=home-theatre, module=name" with name being the name of the helper or 'core' for the main freevo application. </p>
<p>First let's make an example how to use client server communication over mbus. That's the only thing working right now in the wrapper, events will come later. PyMbus supports much more than the mcomm layer, so maybe it is necessary to import mbus in a plugin for special stuff. </p>

<h3 id="head-da2c960c3e618a0716c401064b2b6b207e26509a">Creating a server</h3>

<p>To create a server you must inherit from mcomm.RPCServer. It is possible to have more than one server on one bus, the class is only a wrapper for easy access. Each function starting with __rpc_ and ending with __ will be registered as rpc to the mbus entity. So let's say you have a plugin listening to the rpc home.theatre.play, you would create the following plugin: 
</p>
<pre>
class PluginInterface(plugin.Plugin, mcomm.RPCServer):
    def __init__(self):
        plugin.Plugin.__init__(self)
        mcomm.RPCServer.__init__(self)

    def __rpc_play__(self, addr, val):
        file = self.parse_parameter(val, ( str, ))

        if not eventhandler.is_menu():
            return mcomm.RPCError('freevo not in menu mode')

        menuw  = eventhandler.get()
        parent = menuw.menustack[-1].selected

        for p in plugin.mimetype(None):
            i = p.get(parent, [ file ] )
            if i and hasattr(i[0], 'play'):
                i[0].play(menuw=menuw)
                return mcomm.RPCReturn([])

        return mcomm.RPCError('no player found')
</pre>
<p>Simple, isn't it? </p>

<h3 id="head-fc8f2a0c3bf9ac26c708aa5efae3bc454dab6876">Client</h3>

<p>Now, how does the client look like? </p>

<pre>
freevo = mcomm.find('freevo')

if not freevo:
    print 'freevo not running'
    sys.exit(0)

try:
    freevo.play('/my/file.mp3')
except mcomm.MException, e:
    print e
</pre>
<p>That's all. mcomm.find will wait on the bus until the freevo core comes up (timeout 10 sec). Calling freevo.play will result in a mbus call home-theatre.play with the given argument. There are three possible returns: </p>
<p>1. (True, return values): The server sent mcomm.RPCReturn(return values). Everything worked as expected. </p>
<p>2. (False, reason): The server send mcomm.RPCError(reason). The parameter are ok, but it was not possible to do what expected. </p>
<p>3. mcomm.MException is raised. Something went wrong. Possible reasons are a crash on server side, a server not answering and so on. </p>
<p>freevo.play will block until the result is there. If you don't want to wait, you can specify a callback to the function: 
</p>
<pre>
freevo.play('/my/file.mp3', callback=my_function)
</pre>
<p>This callback will get the raw mbus return, no True, False or MException stuff. </p>

<h2 id="head-60aaf65c3022011dec7475b38384b80dd246250e">PyMbus</h2>

<p>PleaseUpdate: add basic PyMbus doc here </p>
<a id="bottom"></a>

</div>
<p id="pageinfo" class="info" lang="en" dir="ltr">last edited 2004-12-12 11:08:31 by <span title="134.102.71.53">Dischi</span>
<br>Current version: <a href="http://freevo.sourceforge.net/cgi-bin/freevo-2.0/SourceDoc/Mbus">http://freevo.sourceforge.net/cgi-bin/freevo-2.0/SourceDoc/Mbus</a></p>
</div> <!-- end page -->
</body>
</html>
