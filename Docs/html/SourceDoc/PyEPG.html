<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">


<title>SourceDoc/PyEPG - Freevo 2.0 Wiki</title>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin-1.3.1/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/moin-1.3.1/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/moin-1.3.1/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" href="/moin-1.3.1/modern/css/freevo.css">

<link rel="alternate" title="Freevo 2.0 Wiki Recent Changes" href="/cgi-bin/freevo-2.0/RecentChanges?action=rss_rc&amp;ddiffs=1&amp;unique=1" type="application/rss+xml">
<link rel="Start" href="/cgi-bin/freevo-2.0/Index">
<link rel="Alternate" title="Wiki Markup" href="/cgi-bin/freevo-2.0/SourceDoc/PyEPG?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/cgi-bin/freevo-2.0/SourceDoc/PyEPG?action=print">
<link rel="Up" href="/cgi-bin/freevo-2.0/SourceDoc">
<link rel="Search" href="/cgi-bin/freevo-2.0/FindPage">
<link rel="Index" href="/cgi-bin/freevo-2.0/TitleIndex">
<link rel="Glossary" href="/cgi-bin/freevo-2.0/WordIndex">
<link rel="Help" href="/cgi-bin/freevo-2.0/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">

            <!-- Header Logo and Status Line -->
<div id="titlebar"><span class="name"><a href="http://freevo.sourceforge.net/" target="_blank">Freevo</a></span></div>
<div id="header">
<ul>

	<li><a href="../Index.html">User Documentation</a></li>
	<li id="current"><a href="../SourceDoc.html">Source Documenation</a></li>
        
</ul>
</div>
<p>&nbsp;</p>
<div id="page" lang="en" dir="ltr"><!-- start page -->


<h1 id="title">SourceDoc/PyEPG</h1>
<div lang="en" id="content" dir="ltr">
<a id="top"></a>
<ol>

<li>
<a href="#head-a2107bc32b8b821c9c1e2edfa936eaecc507741e">Setup the database</a>
</li>

<li>
<a href="#head-b8773bc18a6308428cfda06bfa9e33f729b9d9f2">Update the database</a>
<ol>

<li>
<a href="#head-1c9d34b9af41344d64061bab977e2093b7459a2a">Using the XMLTV backend</a>
</li>

<li>
<a href="#head-20e8543fa3acf8ff1ab8d665b8fc4779be541499">Using the VDR backend</a>
</li>

</ol>

<li>
<a href="#head-02edeab41680c7a34aca2e1a3175eb310803c2ec">Access the database</a>
<ol>

<li>
<a href="#head-6393b14fb772eacd6505d6dee8fa09342f268fec">Getting channels</a>
</li>

<li>
<a href="#head-48922fa729a6982fafdff8709ba01638d9a2a43c">Using the channel objects to get program listing</a>
</li>

<li>
<a href="#head-9357e4ec774c557de7688a5e206d6f4b98e714ca">Searching the database</a>
</li>

</ol>

<li>
<a href="#head-9f69672c29b1795feaff6e02547d4bc3aac4ed5a">Writing a source backend</a>
</li>

<li>
<a href="#head-8b570a5eb627e6650735a33846c9ae985c510ef6">Writing a database backend</a>
</li>

</ol>
<p> </p>
<p>PyEPG is an electronic program guide with a database frontent. It is located in the Freevo source tree at lib/pyepg but it does not depend on Freevo. It only depends on a working sql database interface, right now only <a class="external" href="http://sqlite.sf.net"><img src="/moin-1.3.1/modern/img/moin-www.png" alt="[WWW]" height="11" width="11"> pysqlite</a> is supported. </p>

<h2 id="head-a2107bc32b8b821c9c1e2edfa936eaecc507741e">Setup the database</h2>

<p>Before a program can use PyEPG the module needs to be connect to a database and load the channel list. To connect to a database you need to specify the type of the database and arguments this databse needs. For sqlite this is the path of the databse file. 
</p>
<pre>
pyepg.connect('sqlite', '/path/to/db')
</pre>
<p>After that the database must be loaded. This will load all channel informatiosn from the database and create an internal structure of channels. You can add channels to the internal list even if they are not in the database itself, rename channels or exclude channels from the guide. The load function has two optional parameters, the first one the list of (channel id, name) to be added and the second one a list of channel ids to be excluded. If the channel id of the first parameter is already in the database, the internal channel name will be replaced with the given one. All channels given here will also be added on top of the internal list. 
</p>
<pre>
channels = [ ('ard.de', 'ARD'), ('zdf.de': 'ZDF') ]
exclude  = [ 'prosieben.de' ]
pyepg.load(channels, exclude)
</pre>

<h2 id="head-b8773bc18a6308428cfda06bfa9e33f729b9d9f2">Update the database</h2>

<p>To update the database call the PyEPG update function. The first parameter if the backend which should do the update. Right now there are two backends: xmltv and vdr. Both have a different set of arguments, so the specific update call is different. </p>

<h3 id="head-1c9d34b9af41344d64061bab977e2093b7459a2a">Using the XMLTV backend</h3>

<p>The <a href="../XMLTV.html">XMLTV</a> backend gets only one additional parameter, the TV.xml file containing the data. 
</p>
<pre>
pyepg.update('xmltv', '/tmp/TV.xml')
</pre>

<h3 id="head-20e8543fa3acf8ff1ab8d665b8fc4779be541499">Using the VDR backend</h3>

<p>The VDR backend requires vdrpylib to be installed (from CVS), which can be found at <a href="http://sourceforge.net/projects/vdrpylib/"><img src="/moin-1.3.1/modern/img/moin-www.png" alt="[WWW]" height="11" width="11"> http://sourceforge.net/projects/vdrpylib/</a>.  Updating from VDR does not require any more parameters but you may pass some to override the defaults set by PyEPG and vdrpylib.  The simplest update call would be: 
</p>
<pre>
pyepg.update('vdr')
</pre>
<p>However, other parameters (defaults shown) available are: 
</p>
<pre>
vdr_dir='/video'
channels_file='channels.conf'
epg_file='epg.dat'
host='localhost'
port=2001
access_by='sid'
</pre>
<p>So, Freevo's tv_grab helper does the following: 
</p>
<pre>
pyepg.update('vdr', config.VDR_DIR, config.VDR_CHANNELS, config.VDR_EPG,
             config.VDR_HOST, config.VDR_PORT, config.VDR_ACCESS_ID)
</pre>

<h2 id="head-02edeab41680c7a34aca2e1a3175eb310803c2ec">Access the database</h2>


<h3 id="head-6393b14fb772eacd6505d6dee8fa09342f268fec">Getting channels</h3>

<p>There are two ways to get a channel object. The first one is using _<tt>_getitem_</tt>_ on the guide object. It is possible to use an integer as index or the database id. The second way is to use the channel object which is a sorted list of all channels. </p>

<pre>
pyepg.channels
pyepg.guide[2]
pyepg.guide['ard.de']
</pre>
<p>When you have a channel object, you can get previous and following channels with the get_channel function. This function will wrap around if the begging or end of the list is reached. 
</p>
<pre>
c = pyepg.guide[2]
pypeg.guide[4] == pyepg.get_channel(c, 2)
</pre>

<h3 id="head-48922fa729a6982fafdff8709ba01638d9a2a43c">Using the channel objects to get program listing</h3>

<p>If you have a channel object, you can access it's attributes and program listings. You can access every time frame you want, if no data is in the database at this point, dummy programs with the id -1 will be returned. </p>
<p>The channel has the following attributes: </p>
<ul>
<li><p> id: id inside the database </p>
</li>
<li><p> access_id: access id for tuner etc. </p>
</li>
<li><p> logo: url of a logo </p>
</li>
<li><p> name: channel name </p>
</li>
<li><p> title: channel display name </p>
</li>
</ul>
<p>To get programs from the epg about the channel use __getitem__ function from Python. 
</p>
<pre>
channel = pyepg.guide['ard.de']
now = time.time()
channel[now]              # what is running now
channel[now:now + 60*60]  # what is running in the next hour
channel[now:]             # everything in the db from now on
</pre>

<h3 id="head-9357e4ec774c557de7688a5e206d6f4b98e714ca">Searching the database</h3>

<p>You can use the search function to search the guide for a specific title. On optional second parameter is a channel id if you want to limit the search to a specific channel. Result is a list of Program objects. 
</p>
<pre>
pyepg.search('Tagesschau')
pyepg.search('Heute Journal', 'zdf.de')
</pre>

<h2 id="head-9f69672c29b1795feaff6e02547d4bc3aac4ed5a">Writing a source backend</h2>

<p>A source must be in the current Python path and must be named source_backend.py, e.g. source_xmltv.py or source_vdr.py. It needs to provide an update function. This function gets the guide object as first parameter and all other parameters from the pyepg.update call. </p>
<p>The source backend will need some internal functions from the guide itself to add the channels and programs to the database. 
</p>
<pre>
guide.sql_add_channel(id, display_name, access_id)
guide.sql_get_channel_ids()
guide.sql_add_program(self, channel_id, title, start, stop,
                      subtitle, description, episode)
guide.exclude_channels
</pre>

<h2 id="head-8b570a5eb627e6650735a33846c9ae985c510ef6">Writing a database backend</h2>

<p>A database backend must be in the current Python path and must be named db_backend.py, e.g. db_sqlite.py or db_mysql.py. The name of the class must be 'Database'. The arguments of the init function will be based to the object when calling 'pyepg.connect'. The database backend must provide three functions: 'execute', 'commit' and 'close'. In case of blocking the database must take care of <a href="../SourceDoc/Notifier.html">PyNotifier</a> to keep the main loop alive. 
</p>
<pre>
class Database:
    def __init__(self, argument listing):
        [...]

    def execute(self, query):
        [...]

    def commit(self):
        [...]

    def close(self):
        [...]
</pre>
<a id="bottom"></a>

</div>
<p id="pageinfo" class="info" lang="en" dir="ltr">last edited 2004-12-15 15:44:27 by <span title="halifax-cr-gw.infointeractive.com">rshortt</span>
<br>current version: <a href="http://freevo.sourceforge.net/cgi-bin/freevo-2.0/SourceDoc/PyEPG">http://freevo.sourceforge.net/cgi-bin/freevo-2.0/SourceDoc/PyEPG</a></p>
</div> <!-- end page -->
</body>
</html>
