<!DOCTYPE html> 
<html> 
<head> 
	<title>Freevo</title> 
	
	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="jquery/jquery.mobile-1.2.0-beta.1.min.css" />
	<script src="jquery/jquery-1.8.1.min.js"></script>
	<script src="jquery/jquery.mobile-1.2.0-beta.1.min.js"></script>
</head> 
<body> 

<div data-role="page">

	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1>Freevo</h1>
	</div><!-- /header -->

	<div data-role="content" id="content">	
	</div><!-- /content -->

	<div data-role="footer" data-position="fixed"
	     data-transition="none" data-fullscreen="true" data-tap-toggle="false">
	  <div data-role="navbar">
	    <!-- navbar is wrong here, we need a button bar -->
	    <ul id="navbar">
	      <li id='BACK'><a href="#">Back</a></li>
	      <li id='HOME'><a href="#">Home</a></li>
	      <li id='SUBMENU'><a href="#">Submenu</a></li>
	    </ul>
	  </div><!-- /navbar -->
	  <script>
            var current = 1;
            $('#navbar').delegate("li", "click", function (e) {
                    current = $(this);
	            // this does not work
                    $.ajax({
                      url: "/select/" + $(this).attr('id'),
                      cache: false,
                      complete: function () {
                    current.children('a').removeClass("ui-btn-active");
            }
                    });
            });
	  </script>
	</div><!-- /footer -->
</div><!-- /page -->

</body>
</html>

 <script>

var known = 'None';

(function fillSectionsPage() {

    $.ajax({
        url: '/view?known=' + known,
        dataType: 'json',
        cache: false,
        success: function(data) {

            $('#content').empty()
            $('#content').append('<ul data-role="listview" data-inset="true" data-filter="true" id="list"></ul>');

            var items = '';
            $.each(data.menu, function(index, item){
                 items += '<li id="' + item.id + '">' + item.name + '</li>';
            });

            $('#list').append(items);
            $('#list').delegate("li", "click", function (e) {
                    $.ajax({
                      url: "/select/" + $(this).attr('id'),
                      cache: false,
                    });
		});
            $('#list').listview();
            known = data.status;
        },
        error: function() {
            // FIXME: wait some seconds before trying again!
        },
        complete: fillSectionsPage, timeout: 30000});
})();

</script>
